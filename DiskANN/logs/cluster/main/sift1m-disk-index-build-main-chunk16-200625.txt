root@d68bb35db821:/app# ./scripts/tests/build_disk_index.sh
Starting index build: R=64 L=128 Query RAM budget: 3.22123e+06 Indexing ram budget: 1 T: 48
Compressing 128-dimensional data into 3 bytes per vector.
Opened: ./data/sift/sift_base.bin, size: 512000008, cache_size: 67108864
Training data with 255621 samples loaded.
Reading bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin ...
Opening bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin... 
Metadata: #pts = 256, #dims = 128...
done.
PQ pivot file exists. Not generating again
Opened: ./data/sift/sift_base.bin, size: 512000008, cache_size: 67108864
Reading bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin ...
Opening bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin... 
Metadata: #pts = 4, #dims = 1...
done.
Reading bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin ...
Opening bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin... 
Metadata: #pts = 256, #dims = 128...
done.
Reading bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin ...
Opening bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin... 
Metadata: #pts = 128, #dims = 1...
done.
Reading bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin ...
Opening bin file ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_pq_pivots.bin... 
Metadata: #pts = 4, #dims = 1...
done.
Loaded PQ pivot information
Processing points  [0, 1000000)...done.
Time for generating quantized data: 2.771951 seconds
Full index fits in RAM budget, should consume at most 0.914633GiBs, so building in one shot
L2: Using AVX2 distance computation DistanceL2Float
Passed, empty search_params while creating index config
L2: Using AVX2 distance computation DistanceL2Float
Opened: ./data/sift/sift_base.bin, size: 512000008, cache_size: 67108864
Training data with 255920 samples loaded.
Processing chunk 0 with dimensions [0, 8)
Processing chunk 1 with dimensions [8, 16)
Processing chunk 2 with dimensions [16, 24)
Processing chunk 3 with dimensions [24, 32)
Processing chunk 4 with dimensions [32, 40)
Processing chunk 5 with dimensions [40, 48)
Processing chunk 6 with dimensions [48, 56)
Processing chunk 7 with dimensions [56, 64)
Processing chunk 8 with dimensions [64, 72)
Processing chunk 9 with dimensions [72, 80)
Processing chunk 10 with dimensions [80, 88)
Processing chunk 11 with dimensions [88, 96)
Processing chunk 12 with dimensions [96, 104)
Processing chunk 13 with dimensions [104, 112)
Processing chunk 14 with dimensions [112, 120)
Processing chunk 15 with dimensions [120, 128)
Writing bin: ./data/sift/sift_base.binpq16_pivots.bin
bin: #pts = 256, #dims = 128, size = 131080B
Finished writing bin.
Writing bin: ./data/sift/sift_base.binpq16_pivots.bin
bin: #pts = 128, #dims = 1, size = 520B
Finished writing bin.
Writing bin: ./data/sift/sift_base.binpq16_pivots.bin
bin: #pts = 17, #dims = 1, size = 76B
Finished writing bin.
Writing bin: ./data/sift/sift_base.binpq16_pivots.bin
bin: #pts = 4, #dims = 1, size = 40B
Finished writing bin.
Saved pq pivot data to ./data/sift/sift_base.binpq16_pivots.bin of size 135772B.
Opened: ./data/sift/sift_base.bin, size: 512000008, cache_size: 67108864
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 4, #dims = 1...
done.
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 256, #dims = 128...
done.
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 128, #dims = 1...
done.
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 17, #dims = 1...
done.
Loaded PQ pivot information
Processing points  [0, 1000000)...done.
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 4, #dims = 1...
done.
Offsets: 4096 135176 135696 135772
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 256, #dims = 128...
done.
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 128, #dims = 1...
done.
Reading bin file ./data/sift/sift_base.binpq16_pivots.bin ...
Opening bin file ./data/sift/sift_base.binpq16_pivots.bin... 
Metadata: #pts = 17, #dims = 1...
done.
Loaded PQ Pivots: #ctrs: 256, #dims: 128, #chunks: 16
Using only first 1000000 from file.. 
Starting index build with 1000000 points... 
90% of index build completed.Starting final cleanup..done. Link time: 29.6279s
Index built with degree: max:64  avg:64  min:64  count(deg<2):0
Not saving tags as they are not enabled.
Time taken for save: 0.977228s.
Time for building merged vamana index: 83.989029 seconds
Opened: ./data/sift/sift_base.bin, size: 512000008, cache_size: 67108864
Vamana index file size=260000024
Opened: ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_disk.index, cache_size: 67108864
medoid: 123742B
max_node_len: 772B
nnodes_per_sector: 5B
# sectors: 200000
Sector #0written
Sector #100000written
Finished writing 819204096B
Writing bin: ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_disk.index
bin: #pts = 9, #dims = 1, size = 80B
Finished writing bin.
Output disk index file written to ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_disk.index
Finished writing 819204096B
Time for generating disk layout: 4.709342 seconds
Opened: ./data/sift/sift_base.bin, size: 512000008, cache_size: 67108864
Loading base ./data/sift/sift_base.bin. #points: 1000000. #dim: 128.
Wrote 100069 points to sample file: ./index/sift/disk_index_sift_learn_R64_L128_A1.2_PQ16_sample_data.bin
Indexing time: 92.263
